<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>content&#x2F;preferences&#x2F;controllers&#x2F;SMETHAdvancedPreferencesController.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/SMETHAcknowledgementController.html">SMETHAcknowledgementController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAcknowledgementPreferencesController.html">SMETHAcknowledgementPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAddressBookController.html">SMETHAddressBookController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAdvancedPreferencesController.html">SMETHAdvancedPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAttachmentController.html">SMETHAttachmentController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAutomaticAcknowledgementController.html">SMETHAutomaticAcknowledgementController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHBankPreferencesController.html">SMETHBankPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHComposeMessageController.html">SMETHComposeMessageController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHControlFactory.html">SMETHControlFactory</a></li>
            
                <li><a href="..&#x2F;classes/SMETHExportController.html">SMETHExportController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHHeaderController.html">SMETHHeaderController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMail.html">SMETHMail</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMailPreferencesController.html">SMETHMailPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMessageHandler.html">SMETHMessageHandler</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMessageListController.html">SMETHMessageListController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHOptionController.html">SMETHOptionController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHRawContentController.html">SMETHRawContentController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHReadMessageController.html">SMETHReadMessageController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHReportController.html">SMETHReportController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHRequestController.html">SMETHRequestController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHUtils.html">SMETHUtils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/smeth.html">smeth</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: content&#x2F;preferences&#x2F;controllers&#x2F;SMETHAdvancedPreferencesController.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;* ***** BEGIN LICENSE BLOCK *****
 * This file is part of smeth (https:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;sepamail-smeth&#x2F;)
 *
 * Version: MPL 2.0&#x2F;GPL 3.0&#x2F;LGPL 3.0
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http:&#x2F;&#x2F;www.mozilla.org&#x2F;MPL&#x2F;2.0&#x2F;
 *
 * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Initials Developers of the Original Code are :
 *  Ammit Heeramun, idSoft
 *  Bishan Kumar Madhoo, idSoft
 *  Manfred Sherlock Olm, deciBI &amp; vizGet
 * Portions created by the Initials Developers are Copyright (C) 2012
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *  Ammit Heeramun
 *  Bishan Kumar Madhoo
 *  Manfred Sherlock Olm, smeth@decibi.fr
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 3 or later (the &quot;GPL&quot;), or
 * the GNU Lesser General Public License Version 3.0 or later (the &quot;LGPL&quot;),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** *&#x2F;

&#x2F;**
 * @module smeth
 * @file SMETHAdvancedPreferencesController.js
 * @mvc controller
 * @version 1212
 * @since 1210
 * @author Bishan Kumar Madhoo
 * @description SMETHAdvancedPreferencesController manages the SMETH advanced preferences pane
 *&#x2F;

&#x2F;**
 * SMETHMessageHandler class contain functions to handle info, error, warning and exceptions messages
 *
 * @include SMETHMessageHandler.js
 *&#x2F;
Components.utils.import(&quot;resource:&#x2F;&#x2F;smeth&#x2F;smethlib&#x2F;SMETHMessageHandler.js&quot;);

&#x2F;**
 * Strict mode for scripts
 * @see https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;JavaScript&#x2F;Reference&#x2F;Functions_and_function_scope&#x2F;Strict_mode
 *
 *&#x2F;
&quot;use strict&quot;;

&#x2F;**
 * SMETHAdvancedPreferencesController manages the SMETH advanced preferences pane
 *
 * @class SMETHAdvancedPreferencesController
 *&#x2F;
var SMETHAdvancedPreferencesController = {

    &#x2F;**
     * Array of message types for which acknowledgement missive XML documents are sent
     *
     * @attribute _smethAcknowledgementMessageTypes
     * @private
     * @default null
     *&#x2F;
    _smethAcknowledgementMessageTypes: null,

    &#x2F;**
     * Message composition settings
     *
     * @attribute _smethCompositionSettings
     * @private
     * @default null
     *&#x2F;
    _smethCompositionSettings: null,

    &#x2F;**
     * Settings for SMETH controller
     *
     * @attribute _smethControllerConfigSettings
     * @private
     * @default null
     *&#x2F;
    _smethControllerConfigSettings: null,

    &#x2F;**
     * List of ecosystems
     *
     * @attribute _smethEcosystems
     * @private
     * @default null
     *&#x2F;
    _smethEcosystems: null,

    &#x2F;**
     * Declare the SMETHMessageHandler class
     *
     * @attribute _smethMessageHandler
     * @private
     *&#x2F;
    _smethMessageHandler : new SMETHMessageHandler(window),

    &#x2F;**
     * Array of SEPAmail message types
     *
     * @attribute _smethMessageTypes
     * @private
     * @default null
     *&#x2F;
    _smethMessageTypes : null,

    &#x2F;**
     * SMETH preferences initialisation flag
     *
     * @attribute _smethPreferencesHasBeenInitialised
     * @private
     * @default false
     *&#x2F;
    _smethPreferencesHasBeenInitialised : false,

    &#x2F;**
     * Declare the smeth preferences class
     *
     * @attribute _smethPreferences
     * @private
     * @see https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Code_snippets&#x2F;Preferences#XPCOM_interfaces_for_preferences_system
     *&#x2F;
    _smethPreferences : Components.classes[&quot;@mozilla.org&#x2F;preferences-service;1&quot;]
                                  .getService(Components.interfaces.nsIPrefService)
                                  .getBranch(&#x27;extensions.smeth.&#x27;),

    &#x2F;**
     * Add a SEPAmail message type to the list of acknowledgement message types
     *
     * @method addAcknowledgementMessageType
     *&#x2F;
    addAcknowledgementMessageType : function() {

        &#x2F;&#x2F; SEPAmail message types listbox
        var listbox = document.getElementById(&#x27;sepamailMessageTypes&#x27;);

        &#x2F;&#x2F; Get selected message type
        var messageType = listbox.getSelectedItem(0).value;

        &#x2F;&#x2F; Add the message type to the array of acknowledgement message types
        this._smethAcknowledgementMessageTypes.push(messageType);

        &#x2F;&#x2F; Clear all the items being displayed in the acknowledgement message types listbox
        this._clearListbox(&#x27;acknowledgementMessageTypes&#x27;);

        &#x2F;&#x2F; Repopulate the listbox
        this._populateAcknowledgementMessageTypes();

        &#x2F;&#x2F; Disable the add SEPAmail message type to acknowledgement message types button
        document.getElementById(&#x27;addAcknowledgementMessageType&#x27;).disabled = true;

        &#x2F;&#x2F; Set focus to the SEPAmail message types listbox
        listbox.focus();
    },

    &#x2F;**
     * Add an unassigned SEPAmail message type to the list of assigned messages for the current ecosystem
     *
     * @method addEcoSepamailMessageType
     *&#x2F;
    addEcoSepamailMessageType : function() {

        &#x2F;&#x2F; Preference UI elements
        var ecosystemListbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);
        var unassignedMessagesListbox = document.getElementById(&#x27;ecoUnassginedSepamailMessages&#x27;);

        &#x2F;&#x2F; Add the selected message type to the current ecosystem
        this._smethEcosystems[ecosystemListbox.selectedIndex].messages.push(unassignedMessagesListbox.value);

        &#x2F;&#x2F; Update the list of assigned and unassigned messate types
        this.fillEcosystemMessages();
        this.fillUnassignedEcosystemMessages();

        &#x2F;&#x2F; Set focus to the list of ecosystems
        ecosystemListbox.focus();
    },

    &#x2F;**
     * Add a new ecosystem to SMETH
     *
     * @method addEcosystem
     *&#x2F;
    addEcosystem : function() {

        &#x2F;&#x2F; Thunderbird prompt service
        var prompts = Components.classes[&quot;@mozilla.org&#x2F;embedcomp&#x2F;prompt-service;1&quot;]
                                .getService(Components.interfaces.nsIPromptService);

        &#x2F;&#x2F; Prompt window defaults
        var check = {value : false};

        &#x2F;&#x2F; New ecosystem name
        var name = {value: &#x27;&#x27;};

        &#x2F;&#x2F; Prompt user for new ecosystem name
        var result = prompts.prompt(null, SMETHAdvancedPrefpaneLocale.newEcosystemTitle,
            SMETHAdvancedPrefpaneLocale.newEcosystemPrompt, name, null, check);

        &#x2F;&#x2F; Check if user has chosen to add a new ecosystem and a name has been specified
        if (result &amp;&amp; name.value.trim().length &gt; 0) {

            &#x2F;&#x2F; Unique ID generator
            var uuidGenerator = Components.classes[&quot;@mozilla.org&#x2F;uuid-generator;1&quot;]
                                          .getService(Components.interfaces.nsIUUIDGenerator);

            &#x2F;&#x2F; Add new ecosystem object
            this._smethEcosystems.push({id : uuidGenerator.generateUUID().toString(), name: name.value.trim(),
                mode: &#x27;test&#x27;, messages:[]});

            &#x2F;&#x2F; Refresh the list of ecosystems
            this._populateEcosystems();
        }

        &#x2F;&#x2F; Set focus to the listbox
        document.getElementById(&#x27;ecosystemsListbox&#x27;).focus();
    },

    &#x2F;**
     * Add a SEPAmail message type
     *
     * @method addMessageType
     *&#x2F;
    addMessageType : function() {

        &#x2F;&#x2F; SEPAmail message type textbox
        var textbox = document.getElementById(&#x27;messageTypeValue&#x27;);

        &#x2F;&#x2F; Add the message type to the array of SEPAmail message types
        this._smethMessageTypes.push(textbox.value);

        &#x2F;&#x2F; Clear all the items being displayed in the SEPAmail message types listbox
        this._clearListbox(&#x27;sepamailMessageTypes&#x27;);

        &#x2F;&#x2F; Populate the list of SEPAmail message types
        this._populateMessageTypes();

        &#x2F;&#x2F; Add new message type to SEPAmail message types listbox
        document.getElementById(&#x27;sepamailMessageTypeSettings&#x27;).appendItem(textbox.value, textbox.value);

        &#x2F;&#x2F; Create settings UI for new message type
        var messageTypeSettingsUi = document.createElement(&#x27;sepamailmessagetypesettings&#x27;);
        messageTypeSettingsUi.setAttribute(&#x27;flex&#x27;, &#x27;1&#x27;);
        messageTypeSettingsUi.setAttribute(&#x27;messageType&#x27;, textbox.value);
        document.getElementById(&#x27;sepamailMessageTypeSettingsContainer&#x27;).appendChild(messageTypeSettingsUi);

        &#x2F;&#x2F; Clear the new SEPAmail message type textbox
        textbox.value = &#x27;&#x27;;

        &#x2F;&#x2F; Disable the add new SEPAmail message type button
        document.getElementById(&#x27;addMessageType&#x27;).disabled = true;

        &#x2F;&#x2F; Set focus to the SEPAmail message types listbox
        document.getElementById(&#x27;sepamailMessageTypes&#x27;).focus();
    },

    &#x2F;**
     * Populate the list of SEPAmail messages assigned to the selected ecosystem
     *
     * @method fillEcosystemMessages
     *&#x2F;
    fillEcosystemMessages : function() {

        &#x2F;&#x2F; Preference UI elements
        var ecosystemListbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);
        var ecosystemMessageListbox = document.getElementById(&#x27;ecoAssignedSepamailMessages&#x27;);

        &#x2F;&#x2F; Clear the list of messages
        this._clearListbox(&quot;ecoAssignedSepamailMessages&quot;);

        &#x2F;&#x2F; Get the ecosystem object for the selected ecosystem
        var ecosystem = this._smethEcosystems[ecosystemListbox.selectedIndex];

        &#x2F;&#x2F; Fill in the list of SEPAmail messages
        for (var i = 0; i &lt; ecosystem.messages.length; i++) {
            ecosystemMessageListbox.appendItem(ecosystem.messages[i], ecosystem.messages[i]);
        }
    },

    &#x2F;**
     * Fill the listbox of SEPAmail messages that have not been assigned to ecosystems
     *
     * @method fillUnassignedEcosystemMessages
     *&#x2F;
    fillUnassignedEcosystemMessages : function() {

        &#x2F;&#x2F; Preference UI elements
        var unassignedEcosystemMessagesListbox = document.getElementById(&#x27;ecoUnassginedSepamailMessages&#x27;);

        &#x2F;&#x2F; Clear the list of unassigned SEPAmail messages
        this._clearListbox(&quot;ecoUnassginedSepamailMessages&quot;);

        &#x2F;&#x2F; Build the list of assigned messages
        var assignedMessages = [];
        for (var i = 0; i &lt; this._smethEcosystems.length; i++) {
            for (var j = 0; j &lt; this._smethEcosystems[i].messages.length; j++) {
                assignedMessages.push(this._smethEcosystems[i].messages[j]);
            }
        }

        &#x2F;&#x2F; Get unassigned message types
        var unassignedMessages = [];
        for (var k = 0; k &lt; this._smethMessageTypes.length; k++) {
            if (assignedMessages.indexOf(this._smethMessageTypes[k]) &lt; 0) {
                unassignedMessages.push(this._smethMessageTypes[k]);
            }
        }

        &#x2F;&#x2F; Fill in the listbox of unassigned message types
        for (var l = 0; l &lt; unassignedMessages.length; l++) {
            unassignedEcosystemMessagesListbox.appendItem(unassignedMessages[l], unassignedMessages[l]);
        }
    },

    &#x2F;**
     * Modify an existing ecosystem
     *
     * @method modifyEcosystem
     * @see https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;XPCOM_Interface_Reference&#x2F;nsIPromptService
     *&#x2F;
    modifyEcosystem : function() {

        &#x2F;&#x2F; Ecosystem listbox
        var listbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Thunderbird prompt service
        &#x2F;&#x2F; @see https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;XPCOM_Interface_Reference&#x2F;nsIPromptService
        var prompts = Components.classes[&quot;@mozilla.org&#x2F;embedcomp&#x2F;prompt-service;1&quot;]
                                .getService(Components.interfaces.nsIPromptService);

        &#x2F;&#x2F; Prompt window defaults
        var check = {value : false};

        &#x2F;&#x2F; New ecosystem name
        var name = {value: listbox.selectedItem.label};

        &#x2F;&#x2F; Prompt user for new ecosystem name
        var result = prompts.prompt(null, SMETHAdvancedPrefpaneLocale.newEcosystemTitle,
            SMETHAdvancedPrefpaneLocale.newEcosystemPrompt, name, null, check);

        &#x2F;&#x2F; Check if user has chosen to add a new ecosystem and a name has been specified
        if (result &amp;&amp; name.value.trim().length &gt; 0) {

            &#x2F;&#x2F; Get the index of the ecosystem that is being modified
            var ecosystemIndex = this._getEcosystemIndex(listbox.selectedItem.value);

            &#x2F;&#x2F; Check if the ecosystem was found
            if (ecosystemIndex &gt; -1) {

                &#x2F;&#x2F; Update the array of ecosystems
                this._smethEcosystems[ecosystemIndex].name = name.value.trim();

                &#x2F;&#x2F; Refresh the list of ecosystems
                this._populateEcosystems();
            }
        }

        &#x2F;&#x2F; Set focus to the listbox
        listbox.focus();
    },

    &#x2F;**
     * Handle the event triggered message composition tab is selected
     *
     * @method onComposeMessageTabSelected
     *&#x2F;
    onComposeMessageTabSelected : function() {

        &#x2F;&#x2F; Check if we have ecosystems and SEPAmail message types for message composition
        if (document.getElementById(&#x27;ecosystemMenuList&#x27;).itemCount == 0 &amp;&amp;
            document.getElementById(&#x27;messageTypeMenuList&#x27;).itemCount == 0) {
            this._showNoComposeMenuUi(SMETHAdvancedPrefpaneLocale.nodefinedEcosystemAndMessageTypeMessage);
        }
    },

    &#x2F;**
     * Handle the event triggered when a user changes the value in the message composition settings UI
     *
     * @method onCompositionSettingTextboxesInput
     *&#x2F;
    onCompositionSettingTextboxesInput : function() {

        &#x2F;&#x2F; Message composition settings UI textboxes
        var textboxXml = document.getElementById(&#x27;messageCompositionXml&#x27;);
        var textboxXsl = document.getElementById(&#x27;messageCompositionXsl&#x27;);

        &#x2F;&#x2F; Check if input is valid
        if (textboxXml.value.trim().length &gt; 0 &amp;&amp; textboxXsl.value.trim().length &gt; 0) {
            document.getElementById(&#x27;saveMessageCompositionSetting&#x27;).disabled = false;
        } else {
            document.getElementById(&#x27;saveMessageCompositionSetting&#x27;).disabled = true;
        }
    },

    &#x2F;**
     * onEcosystemMenuListCommand handles the command event of the ecosystem menu list
     *
     * @method onEcosystemMenuListCommand
     *&#x2F;
    onEcosystemMenuListCommand : function() {

        &#x2F;&#x2F; Update the list of message types for the selected ecosystem
        this._fillMessageTypes();
    },

    &#x2F;**
     * Handle the event triggered when the ecosystem settings tab is selected
     *
     * @method onEcosystemTabSelected
     *&#x2F;
    onEcosystemTabSelected : function() {

        &#x2F;&#x2F; Message types listbox
        var listbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Check if the listbox has items and no item is selected
        if (listbox.itemCount &gt; 0 &amp;&amp; listbox.selectedIndex &lt; 0) {
            listbox.selectedIndex = 0;
        }
    },

    &#x2F;**
     * Handle the event called when the SEPAmail message settings tab is selected
     *
     * @method onMessageTypeSettingsTabSelected
     *&#x2F;
    onMessageTypeSettingsTabSelected : function() {

        &#x2F;&#x2F; Message types listbox
        var listbox = document.getElementById(&#x27;sepamailMessageTypeSettings&#x27;);

        &#x2F;&#x2F; Check if the listbox has items and no item is selected
        if (listbox.itemCount &gt; 0 &amp;&amp; listbox.selectedIndex &lt; 0) {
            listbox.selectedIndex = 0;
        }
    },

    &#x2F;**
     * Handle the event triggered when user inputs text in the SEPAmail message type textbox
     *
     * @method onMessageTypeInput
     *&#x2F;
    onMessageTypeInput : function() {

        &#x2F;&#x2F; SEPAmail message type textbox
        var textbox = document.getElementById(&#x27;messageTypeValue&#x27;);

        &#x2F;&#x2F; Add SEPAmail message type button
        var button = document.getElementById(&#x27;addMessageType&#x27;);

        &#x2F;&#x2F; Check if the textbox contains a valid message type name
        if (textbox.value.trim().length &gt; 0) {

            &#x2F;&#x2F; Check that the array of SEPAmail message types does not already contain the new message type name
            if (this._getMessageTypeIndex(textbox.value.trim()) == -1) {

                &#x2F;&#x2F; Enable the add SEPAmail message type button
                button.disabled = false;

            } else {

                &#x2F;&#x2F; Disable the add SEPAmail message type button
                button.disabled = true;
            }

        } else {

            &#x2F;&#x2F; Disable the add SEPAmail message type button
            button.disabled = true;
        }
    },

    &#x2F;**
     * Initialise the SMETH QXBAN preference pane
     *
     * @method onPaneLoad
     *&#x2F;
    onPaneLoad : function() {

        &#x2F;&#x2F; Initialise SMETH preferences
        this._initSmethPreferences();

        try {

            &#x2F;&#x2F; Get missive root tag name
            document.getElementById(&#x27;rootTagValue&#x27;).value = this._smethPreferences.getCharPref(&#x27;missive.prefRootTag&#x27;);

            &#x2F;&#x2F; Get XPath for retrieving the message type from a SEPAmail message
            document.getElementById(&#x27;xPathValue&#x27;).value = this._smethPreferences.getCharPref(&#x27;missive.prefMsgTypXpath&#x27;);

            &#x2F;&#x2F; List of SEPAmail messages
            this._getMessageTypes();
            this._clearListbox(&#x27;sepamailMessageTypes&#x27;);
            this._populateMessageTypes();

            &#x2F;&#x2F; List of acknowledgement message types
            this._getAcknowledgementMessageTypes();
            this._clearListbox(&#x27;acknowledgementMessageTypes&#x27;);
            this._populateAcknowledgementMessageTypes();

            &#x2F;&#x2F; SMETH ecosystems
            this._smethEcosystems = JSON.parse(this._smethPreferences.getCharPref(&#x27;ecosystems&#x27;));

            &#x2F;&#x2F; Populate the list of ecosystems
            this._populateEcosystems();

            &#x2F;&#x2F; Get SEPAmail composition settings
            this._smethCompositionSettings = JSON.parse(this._smethPreferences.getCharPref(&#x27;compositions&#x27;));

            &#x2F;&#x2F; Populate the list of message composition settings
            this._populateCompositionSettings();

            &#x2F;&#x2F; Fill in the ecosystem combobox on the message composition tab
            this._fillEcosystems();

            &#x2F;&#x2F; Fill in the message types combobox on the message composition tab
            this._fillMessageTypes();

            &#x2F;&#x2F; Check if we have ecosystems and SEPAmail message types for message composition
            if (document.getElementById(&#x27;ecosystemMenuList&#x27;).itemCount == 0 &amp;&amp;
                document.getElementById(&#x27;messageTypeMenuList&#x27;).itemCount == 0) {
                this._showNoComposeMenuUi(SMETHAdvancedPrefpaneLocale.nodefinedEcosystemAndMessageTypeMessage);
            }

            &#x2F;&#x2F; SMETH controller settings
            this._smethControllerConfigSettings = JSON.parse(this._smethPreferences.getCharPref(&#x27;controller.config&#x27;));

            &#x2F;&#x2F; List of message type settings
            this._clearListbox(&#x27;sepamailMessageTypeSettings&#x27;);
            this._populateMessageSettingTypes();

            &#x2F;&#x2F; Create UI each SEPAmail message type
            this._createMessageTypeSettingsUi();

        } catch (e) {
            this._smethMessageHandler.exception(e);
        }
    },

    &#x2F;**
     * Handle the event triggered when an item in the list of SEPAmail acknowledgement message types is selected
     *
     * @method onSelectAcknowledgementMessageTypeItem
     *&#x2F;
    onSelectAcknowledgementMessageTypeItem : function() {

        &#x2F;&#x2F; Enable the remove SEPAmail message type button
        document.getElementById(&#x27;removeAckMessageType&#x27;).disabled = false;
    },

    &#x2F;**
     * Handle the event triggered when an item in the ecosystem listbox is selected
     *
     * @method onSelectEcosystem
     *&#x2F;
    onSelectEcosystem : function() {

        &#x2F;&#x2F; Ecosystems listbox
        var listbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Check if an ecosystem was selected
        if (listbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Enable ecosystem action buttons
            document.getElementById(&#x27;modifyEcosystem&#x27;).disabled = false;
            document.getElementById(&#x27;deleteEcosystem&#x27;).disabled = false;

            &#x2F;&#x2F; Populate the list of SEPAmail messages assigned to the selected ecosystem
            this.fillEcosystemMessages();

            &#x2F;&#x2F; Show the ecosystem mode
            this.showEcosystemMode();

            &#x2F;&#x2F; Populate the list of SEPAmail messages that have not been assigned to ecosystems
            this.fillUnassignedEcosystemMessages();

        } else {

            &#x2F;&#x2F; Disable ecosystem action buttons
            document.getElementById(&#x27;modifyEcosystem&#x27;).disabled = true;
            document.getElementById(&#x27;deleteEcosystem&#x27;).disabled = true;
        }
    },

    &#x2F;**
     * onSelectEcosystemAssignedMessage handles the onSelect event of the list of assigned SEPAmail messages
     *
     * @method onSelectEcosystemAssignedMessage
     *&#x2F;
    onSelectEcosystemAssignedMessage : function() {

        &#x2F;&#x2F; Preference UI elements
        var ecosystemMessageListbox = document.getElementById(&#x27;ecoAssignedSepamailMessages&#x27;);
        var removeEcoMessageTypeButton = document.getElementById(&#x27;removeEcoMessageType&#x27;);

        &#x2F;&#x2F; Check if a message has been selected
        if (ecosystemMessageListbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Enable the button which allows to remove an assigned SEPAmail message
            removeEcoMessageTypeButton.disabled = false;
            removeEcoMessageTypeButton.image=&quot;chrome:&#x2F;&#x2F;smeth&#x2F;skin&#x2F;images&#x2F;down.png&quot;;

        } else {

            &#x2F;&#x2F; Disable the button which allows to remove an assigned SEPAmail message
            removeEcoMessageTypeButton.disabled = true;
            removeEcoMessageTypeButton.image=&quot;chrome:&#x2F;&#x2F;smeth&#x2F;skin&#x2F;images&#x2F;down_dis.png&quot;;
        }
    },

    &#x2F;**
     * onSelectEcosystemUnassignedMessage handles the onSelect event of the list of unassigned SEPAmail messages
     *
     * @method onSelectEcosystemUnassignedMessage
     *&#x2F;
    onSelectEcosystemUnassignedMessage : function() {

        &#x2F;&#x2F; Preference UI elements
        var unassignedEcosystemMessagesListbox = document.getElementById(&#x27;ecoUnassginedSepamailMessages&#x27;);
        var addEcoMessageTypeButton = document.getElementById(&#x27;addEcoMessageType&#x27;);

        &#x2F;&#x2F; Check if a message has been selected
        if (unassignedEcosystemMessagesListbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Enable the button which allows to add an unassigned SEPAmail message
            addEcoMessageTypeButton.disabled = false;
            addEcoMessageTypeButton.image=&quot;chrome:&#x2F;&#x2F;smeth&#x2F;skin&#x2F;images&#x2F;up.png&quot;;

        } else {

            &#x2F;&#x2F; Disable the button which allows to add an unassigned SEPAmail message
            addEcoMessageTypeButton.disabled = true;
            addEcoMessageTypeButton.image=&quot;chrome:&#x2F;&#x2F;smeth&#x2F;skin&#x2F;images&#x2F;up_dis.png&quot;;
        }
    },

    &#x2F;**
     * Handle the event triggered when an item in the list of message composition settings is selected
     *
     * @method onSelectCompositionSetting
     *&#x2F;
    onSelectCompositionSetting : function() {

        &#x2F;&#x2F; Message composition settings UI elements
        var listbox = document.getElementById(&#x27;composeMessageSettingsList&#x27;);

        &#x2F;&#x2F; Check if an item is selected
        if (listbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Show the parameters for the selected setting
            document.getElementById(&#x27;ecosystemMenuList&#x27;).value = this._smethCompositionSettings[listbox.selectedIndex].ecosystemId;
            document.getElementById(&#x27;messageTypeMenuList&#x27;).value = this._smethCompositionSettings[listbox.selectedIndex].messageType;
            document.getElementById(&#x27;messageCompositionXml&#x27;).value = this._smethCompositionSettings[listbox.selectedIndex].xml;
            document.getElementById(&#x27;messageCompositionXsl&#x27;).value = this._smethCompositionSettings[listbox.selectedIndex].xsl;
            document.getElementById(&#x27;saveMessageCompositionSetting&#x27;).disabled = false;
            document.getElementById(&#x27;deleteMessageCompositionSetting&#x27;).disabled = false;

        } else {

            &#x2F;&#x2F; Reset the values displayed in the new message composition settings UI
            document.getElementById(&#x27;ecosystemMenuList&#x27;).selectedIndex = 0;
            document.getElementById(&#x27;messageTypeMenuList&#x27;).selectedIndex = 0;
            document.getElementById(&#x27;messageCompositionXml&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;messageCompositionXsl&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;saveMessageCompositionSetting&#x27;).disabled = true;
            document.getElementById(&#x27;deleteMessageCompositionSetting&#x27;).disabled = true;
        }
    },

    &#x2F;**
     * Handle the event triggered when a message type is selected in the message settings list
     *
     * @method onSelectMessageSettingType
     *&#x2F;
    onSelectMessageSettingType : function() {

        &#x2F;&#x2F; Show the message settings for the selected message type
        document.getElementById(&#x27;sepamailMessageTypeSettingsContainer&#x27;).selectedIndex =
            document.getElementById(&#x27;sepamailMessageTypeSettings&#x27;).selectedIndex;
    },

    &#x2F;**
     * Handle the event triggered when an item in the list of SEPAmail message types is selected
     *
     * @method onSelectMessageTypeItem
     *&#x2F;
    onSelectMessageTypeItem : function() {

        &#x2F;&#x2F; SEPAmail message types listbox
        var listbox = document.getElementById(&#x27;sepamailMessageTypes&#x27;);

        &#x2F;&#x2F; Enable the remove SEPAmail message type button
        document.getElementById(&#x27;removeMessageType&#x27;).disabled = false;

        &#x2F;&#x2F; Check if an item is selected
        if (listbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Check if the selected message type exists in the array of acknowledgement message types
            if (this._getAcknowledgementMessageTypeIndex(listbox.getSelectedItem(0).value) == -1) {

                &#x2F;&#x2F; Enable the button which allows a user to add a SEPAmail message type to the list of acknowledgement
                &#x2F;&#x2F; message types
                document.getElementById(&#x27;addAcknowledgementMessageType&#x27;).disabled = false;

            } else {

                &#x2F;&#x2F; Disable the button which allows a user to add a SEPAmail message type to the list of acknowledgement
                &#x2F;&#x2F; message types
                document.getElementById(&#x27;addAcknowledgementMessageType&#x27;).disabled = true;
            }

        } else {

            &#x2F;&#x2F; Disable the button which allows a user to add a SEPAmail message type to the list of acknowledgement
            &#x2F;&#x2F; message types
            document.getElementById(&#x27;addAcknowledgementMessageType&#x27;).disabled = true;
        }

    },

    &#x2F;**
     * Remove the selected message type from the acknowledgement message type list
     *
     * @method removeAckMessage
     *&#x2F;
    removeAckMessage : function() {

        &#x2F;&#x2F; SEPAmail acknowledgement message types listbox
        var listbox = document.getElementById(&#x27;acknowledgementMessageTypes&#x27;);

        &#x2F;&#x2F; Get the index of the selected message type from the array of acknowledgement message types
        var messageTypeIndex = this._getAcknowledgementMessageTypeIndex(listbox.getSelectedItem(0).value);

        &#x2F;&#x2F; Check if the message type was found
        if (messageTypeIndex &gt; -1) {

            &#x2F;&#x2F; Remove the item from the array of acknowledgement message types
            this._smethAcknowledgementMessageTypes.splice(messageTypeIndex, 1);

            &#x2F;&#x2F; Clear all the items being displayed in the acknowledgement message types listbox
            this._clearListbox(&#x27;acknowledgementMessageTypes&#x27;);

            &#x2F;&#x2F; Repopulate the listbox
            this._populateAcknowledgementMessageTypes();

            &#x2F;&#x2F; Disable the remove acknowledgement message type button
            document.getElementById(&#x27;removeAckMessageType&#x27;).disabled = true;

            &#x2F;&#x2F; Focus the acknowledgement message types listbox
            listbox.focus();
        }
    },

    &#x2F;**
     * Remove an assigned SEPAmail message type from the list of assigned messages
     *
     * @method removeEcoSepamailMessageType
     *&#x2F;
    removeEcoSepamailMessageType : function() {

        &#x2F;&#x2F; Preference UI elements
        var ecosystemListbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);
        var ecosystemMessageListbox = document.getElementById(&#x27;ecoAssignedSepamailMessages&#x27;);

        &#x2F;&#x2F; Get the index of the message type that needs to be removed from the ecosystem
        for (var i = 0; i &lt; this._smethEcosystems[ecosystemListbox.selectedIndex].messages.length; i++) {

            &#x2F;&#x2F; Check if we are the required message type
            if (this._smethEcosystems[ecosystemListbox.selectedIndex].messages[i] == ecosystemMessageListbox.value) {

                &#x2F;&#x2F; Remove the message type
                this._smethEcosystems[ecosystemListbox.selectedIndex].messages.splice(i, 1);

                break;
            }
        }

        &#x2F;&#x2F; Update the list of assigned and unassigned messate types
        this.fillEcosystemMessages();
        this.fillUnassignedEcosystemMessages();

        &#x2F;&#x2F; Set focus to the list of ecosystems
        ecosystemListbox.focus();
    },

    &#x2F;**
     * Delete an existing ecosystem and related compose message settings
     *
     * @method removeEcosystem
     *&#x2F;
    removeEcosystem : function() {

        &#x2F;&#x2F; Ecosystem listbox
        var listbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Check if an item has been selected
        if (listbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Thunderbird prompt service
            var promptService = Components.classes[&quot;@mozilla.org&#x2F;embedcomp&#x2F;prompt-service;1&quot;]
                                          .getService(Components.interfaces.nsIPromptService);

            &#x2F;&#x2F; Check if user really wants to remove the selected SEPAmail message type
            if (promptService.confirm(window, SMETHAdvancedPrefpaneLocale.deleteEcosystemTitle,
                SMETHAdvancedPrefpaneLocale.deleteEcosystemPrompt)) {

                &#x2F;&#x2F; Find the index of the selected ecosystem
                var ecosystemIndex = this._getEcosystemIndex(listbox.selectedItem.value);

                &#x2F;&#x2F; Get the ID of the ecosystem
                var ecosystemId = this._smethEcosystems[ecosystemIndex].id;

                &#x2F;&#x2F; Remove the ecosystem for the array of ecosystems
                this._smethEcosystems.splice(ecosystemIndex, 1);

                &#x2F;&#x2F; Remove message composition settings for the ecosystem
                this._removeCompositionSettingsByEcosystemId(ecosystemId);

                &#x2F;&#x2F; Fill in the ecosystem combobox on the message composition tab
                this._fillEcosystems();

                &#x2F;&#x2F; Refresh the list of ecosystems
                this._populateEcosystems();
            }
        }

        listbox.focus();
    },

    &#x2F;**
     * Remove message composition setting
     *
     * @method removeMessageCompositionSetting
     *&#x2F;
    removeMessageCompositionSetting : function() {

        &#x2F;&#x2F; Message composition settings UI elements
        var listbox = document.getElementById(&#x27;composeMessageSettingsList&#x27;);

        &#x2F;&#x2F; Check if an item has been selected
        if (listbox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Remove the selected item from the message composition settings array
            this._smethCompositionSettings.splice(listbox.selectedIndex, 1);

            &#x2F;&#x2F; Refresh the list of settings
            this._populateCompositionSettings();
        }

        listbox.focus();
    },

    &#x2F;**
     * Remove the selected SEPAmail message type from the list of SEPAmail message types
     *
     * @method removeMessageType
     *&#x2F;
    removeMessageType : function() {

        &#x2F;&#x2F; Thunderbird prompt service
        var promptService = Components.classes[&quot;@mozilla.org&#x2F;embedcomp&#x2F;prompt-service;1&quot;]
                                      .getService(Components.interfaces.nsIPromptService);

        &#x2F;&#x2F; Check if user really wants to remove the selected SEPAmail message type
        if (promptService.confirm(window, SMETHAdvancedPrefpaneLocale.confirmDialogTitle,
            SMETHAdvancedPrefpaneLocale.confirmDialogPrompt)) {

            &#x2F;&#x2F; SEPAmail message types listbox
            var listbox = document.getElementById(&#x27;sepamailMessageTypes&#x27;);

            &#x2F;&#x2F; Selected message type
            var selMessageType = listbox.getSelectedItem(0).value;

            &#x2F;&#x2F; Index of selected SEPAmail message type in the array of acknowledgement message types
            var acknowledgementMessageTypeIndex = this._getAcknowledgementMessageTypeIndex(selMessageType);

            &#x2F;&#x2F; Check if the SEPAmail message type exists in the list of acknowledgement message types
            if (acknowledgementMessageTypeIndex &gt; -1) {

                &#x2F;&#x2F; Remove the acknowledgement message type
                this._smethAcknowledgementMessageTypes.splice(acknowledgementMessageTypeIndex, 1);

                &#x2F;&#x2F; Clear the list of acknowledgement message types
                this._clearListbox(&#x27;acknowledgementMessageTypes&#x27;);

                &#x2F;&#x2F; Populate the list of acknowledgement message types
                this._populateAcknowledgementMessageTypes();

                &#x2F;&#x2F; Disable the remove acknowledgement message type button
                document.getElementById(&#x27;removeAckMessageType&#x27;).disabled = true;
            }

            &#x2F;&#x2F; Index of the selected SEPAmail message type
            var sepamailMessageTypeIndex = this._getMessageTypeIndex(selMessageType);

            &#x2F;&#x2F; Remove the SEPAmail message type from the array of SEPAmail message types
            this._smethMessageTypes.splice(sepamailMessageTypeIndex, 1);

            &#x2F;&#x2F; SEPAmail acknowledgement message types listbox
            var settingsListbox = document.getElementById(&#x27;sepamailMessageTypeSettings&#x27;);

            &#x2F;&#x2F; Settings UI deck
            var deck = document.getElementById(&#x27;sepamailMessageTypeSettingsContainer&#x27;);

            &#x2F;&#x2F; Clear message type settings list selection if the message type is currently selected and reset the
            &#x2F;&#x2F; selected deck index
            if (settingsListbox.selectedIndex == sepamailMessageTypeIndex) {
                settingsListbox.selectedIndex = -1;
                deck.selectedIndex = -1;
            }

            &#x2F;&#x2F; Remove message type from the list
            settingsListbox.removeItemAt(sepamailMessageTypeIndex);

            &#x2F;&#x2F; Remove message composition settings for the current message type
            this._removeCompositionSettingsByMessageType(selMessageType);

            &#x2F;&#x2F; Update message types combobox on the message composition tab
            this._fillMessageTypes();

            &#x2F;&#x2F; Remove the settings UI from the settings UI deck
            var deckChild = null;
            for (var i = 0; i &lt; deck.children.length; i++) {

                &#x2F;&#x2F; Check the message type being handled by the current deck child
                if (deck.children[i].getAttribute(&#x27;messageType&#x27;) == selMessageType) {

                    &#x2F;&#x2F; Deck child that needs to be removed from the deck
                    deckChild = deck.children[i];
                    break;
                }
            }

            &#x2F;&#x2F; Remove the child from the deck
            deck.removeChild(deckChild);

            &#x2F;&#x2F; Clear the list of SEPAmail message types being displayed
            this._clearListbox(&#x27;sepamailMessageTypes&#x27;);

            &#x2F;&#x2F; Populate the list of SEPAmail message types
            this._populateMessageTypes();

            &#x2F;&#x2F; Disable the remove SEPAmail message type button
            document.getElementById(&#x27;removeMessageType&#x27;).disabled = true;
        }

        &#x2F;&#x2F; Set focus to list of SEPAmail message types
        document.getElementById(&#x27;sepamailMessageTypes&#x27;).focus();
    },

    &#x2F;**
     * Persist advanced settings
     *
     * @method saveAdvancedSettings
     *&#x2F;
    saveAdvancedSettings : function() {

        &#x2F;&#x2F; Persist missive root tag name
        this._smethPreferences.setCharPref(&#x27;missive.prefRootTag&#x27;, document.getElementById(&#x27;rootTagValue&#x27;).value.trim());

        &#x2F;&#x2F; Persist XPath for retrieving the message type from a SEPAmail message
        this._smethPreferences.setCharPref(&#x27;missive.prefMsgTypXpath&#x27;, document.getElementById(&#x27;xPathValue&#x27;).value.trim());

        &#x2F;&#x2F; Persist SEPAmail message types
        this._smethPreferences.setCharPref(&#x27;missive.prefSEPAmailMessageTypes&#x27;, this._smethMessageTypes.join(&#x27;;&#x27;));

        &#x2F;&#x2F; Persist SEPAmail acknowledgement message types
        this._smethPreferences.setCharPref(&#x27;acknowledgement.types&#x27;, this._smethAcknowledgementMessageTypes.join());

        &#x2F;&#x2F; Persist ecosystems
        this._smethPreferences.setCharPref(&#x27;ecosystems&#x27;, JSON.stringify(this._smethEcosystems));

        &#x2F;&#x2F; Persist message composition settings
        this._smethPreferences.setCharPref(&#x27;compositions&#x27;, JSON.stringify(this._smethCompositionSettings));

        &#x2F;&#x2F; Message type settings UI container
        var deck = document.getElementById(&#x27;sepamailMessageTypeSettingsContainer&#x27;);

        &#x2F;&#x2F; Message type settings array
        var messageTypeSettings = [];

        &#x2F;&#x2F; Build the array of settings for message types
        for (var i = 0; i &lt; deck.children.length; i++) {

            &#x2F;&#x2F; Current deck child
            var currentDeckChild = deck.children[i];

            &#x2F;&#x2F; Settings for the current message type
            messageTypeSettings.push({&quot;type&quot; : currentDeckChild.getAttribute(&#x27;messageType&#x27;),
                &quot;settings&quot; : currentDeckChild.settings });
        }

        &#x2F;&#x2F; Persist message type settings
        this._smethControllerConfigSettings = messageTypeSettings;
        this._smethPreferences.setCharPref(&#x27;controller.config&#x27;, JSON.stringify(this._smethControllerConfigSettings));
    },

    &#x2F;**
     * Save message composition settings
     *
     * @method saveMessageCompositionSetting
     *&#x2F;
    saveMessageCompositionSetting : function() {

        &#x2F;&#x2F; Message composition settings UI elements
        var ecosystemCombobox = document.getElementById(&#x27;ecosystemMenuList&#x27;);
        var messageTypeCombobox = document.getElementById(&#x27;messageTypeMenuList&#x27;);
        var xmlTextbox = document.getElementById(&#x27;messageCompositionXml&#x27;);
        var xslTextbox = document.getElementById(&#x27;messageCompositionXsl&#x27;);

        &#x2F;&#x2F; Get the message composition setting index
        var messageCompositionSettingIndex = this._getCompositionSettingsIndex(ecosystemCombobox.value,
            messageTypeCombobox.value);

        &#x2F;&#x2F; Check if a composition setting for the given ecosystem and message type was found
        if (messageCompositionSettingIndex &gt; -1) {

            &#x2F;&#x2F; Update the details of the existing composition settings
            this._smethCompositionSettings[messageCompositionSettingIndex].xml = xmlTextbox.value.trim();
            this._smethCompositionSettings[messageCompositionSettingIndex].xsl = xslTextbox.value.trim();

        } else {

            &#x2F;&#x2F; Add a new message composition setting
            this._smethCompositionSettings.push({ ecosystemId: ecosystemCombobox.value,
                messageType: messageTypeCombobox.value, xml: xmlTextbox.value.trim(), xsl: xslTextbox.value.trim()});
        }

        &#x2F;&#x2F; Repopulate the list of message composition settings
        this._populateCompositionSettings();
    },

    &#x2F;**
     * Set the mode of the currently selected ecosystem
     *
     * @method setEcosystemMode
     * @param {String} mode Ecosystem mode
     *&#x2F;
    setEcosystemMode : function(mode) {

        &#x2F;&#x2F; Preference UI elements
        var ecosystemListbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Set the ecosystem mode
        this._smethEcosystems[ecosystemListbox.selectedIndex].mode = mode;
    },

    &#x2F;**
     * Show the mode of the selected ecosystem
     *
     * @method showEcosystemMode
     *&#x2F;
    showEcosystemMode : function() {

        &#x2F;&#x2F; Preference UI elements
        var ecosystemListbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);
        var ecosystemModeRadioGroup = document.getElementById(&#x27;ecosystem_mode&#x27;);

        &#x2F;&#x2F; Set the ecosystem mode value
        ecosystemModeRadioGroup.value = this._smethEcosystems[ecosystemListbox.selectedIndex].mode;
    },

    &#x2F;**
     * Clear the items in a combobox
     *
     * @param {String} comboboxId ID of the combobox that needs to be cleared
     * @method _clearCombobox
     *&#x2F;
    _clearCombobox : function(comboboxId) {

        &#x2F;&#x2F; Get combobox
        var combobox = document.getElementById(comboboxId);

        &#x2F;&#x2F; Check if combobox was obtained
        if (combobox != null) {

            &#x2F;&#x2F; Check if the combobox contains items
            if (combobox.itemCount &gt; 0) {

                &#x2F;&#x2F; Remove items from the listbox
                while (combobox.itemCount &gt; 0) {
                    combobox.removeItemAt(0);
                }
            }
        }
    },

    &#x2F;**
     * Clear the items in a listbox
     *
     * @param {String} listboxId ID of the listbox that needs to be cleared
     * @method _clearListbox
     *&#x2F;
    _clearListbox : function(listboxId) {

        &#x2F;&#x2F; Get listbox
        var listbox = document.getElementById(listboxId);

        &#x2F;&#x2F; Check if listbox was obtained
        if (listbox != null) {

            &#x2F;&#x2F; Check if the listbox contains rows
            if (listbox.getRowCount() &gt; 0) {

                &#x2F;&#x2F; Remove items from the listbox
                while (listbox.getRowCount() &gt; 0) {
                    listbox.removeItemAt(0);
                }
            }
        }
    },

    &#x2F;**
     * Clear the children of the message type settings deck
     *
     * @method _clearMessageTypeSettingsDeck
     *&#x2F;
    _clearMessageTypeSettingsDeck : function() {

        &#x2F;&#x2F; Message type settings deck
        var deck = document.getElementById(&#x27;sepamailMessageTypeSettingsContainer&#x27;);

        &#x2F;&#x2F; Remove the children of the deck
        while (deck.hasChildNodes()) {
            deck.removeChild(deck.lastChild);
        }
    },

    &#x2F;**
     * Create settings UI for SEPAmail message types
     *
     * @method _createMessageTypeSettingsUi
     *&#x2F;
    _createMessageTypeSettingsUi : function() {

        &#x2F;&#x2F; Remove all children in the deck
        this._clearMessageTypeSettingsDeck();

        &#x2F;&#x2F; Message type settings deck
        var deck = document.getElementById(&#x27;sepamailMessageTypeSettingsContainer&#x27;);

        &#x2F;&#x2F; Scan the list of SEPAmail message types
        for (var i = 0; i &lt; this._smethMessageTypes.length; i++) {

            &#x2F;&#x2F; Message type settings UI
            var messageTypeSettingsUi = document.createElement(&#x27;sepamailmessagetypesettings&#x27;);
            messageTypeSettingsUi.setAttribute(&#x27;flex&#x27;, &#x27;1&#x27;);
            messageTypeSettingsUi.setAttribute(&#x27;messageType&#x27;, this._smethMessageTypes[i]);

            &#x2F;&#x2F; Current settings for the message type
            var messageTypeSettings = this._getSettingsForMessageType(this._smethMessageTypes[i]);

            &#x2F;&#x2F; Check if we have settings for the given message type
            if (messageTypeSettings != null) {
                messageTypeSettingsUi.setAttribute(&#x27;bodyXSL&#x27;, messageTypeSettings.body);
                messageTypeSettingsUi.setAttribute(&#x27;compositionXSL&#x27;, messageTypeSettings.composition);
                messageTypeSettingsUi.setAttribute(&#x27;templateXML&#x27;, messageTypeSettings.template);
                messageTypeSettingsUi.setAttribute(&#x27;hasAttachment&#x27;, messageTypeSettings.hasAttachments);
                messageTypeSettingsUi.setAttribute(&#x27;attachmentXSL&#x27;, messageTypeSettings.attachment);
            }

            &#x2F;&#x2F; Append the panel to the panels container
            deck.appendChild(messageTypeSettingsUi);
        }
    },

    &#x2F;**
     * Fill the ecosystem combobox on the composition menu tab
     *
     * @method _fillEcosystems
     *&#x2F;
    _fillEcosystems : function() {

        &#x2F;&#x2F; Clear items in the combobox
        this._clearCombobox(&#x27;ecosystemMenuList&#x27;);

        &#x2F;&#x2F; Ecosystems combobox
        var combobox = document.getElementById(&#x27;ecosystemMenuList&#x27;);

        &#x2F;&#x2F; Scan the array of SEPAmail ecosystems
        for (var i = 0; i &lt; this._smethEcosystems.length; i++) {

            &#x2F;&#x2F; Add ecosystem to the combobox
            combobox.appendItem(this._smethEcosystems[i].name, this._smethEcosystems[i].id, &#x27;&#x27;);
        }

        &#x2F;&#x2F; Select the first item in the combobox if it contains items
        if (combobox.itemCount &gt; 0) {
            combobox.selectedIndex = 0;
        } else {
            this._showNoComposeMenuUi(SMETHAdvancedPrefpaneLocale.nodefinedEcosystemMessage);
        }
    },

    &#x2F;**
     * Fill the SEPAmail message types combobox on the composition menu tab
     *
     * @method _fillMessageTypes
     *&#x2F;
    _fillMessageTypes : function() {

        &#x2F;&#x2F; Clear items in the combobox
        this._clearCombobox(&#x27;messageTypeMenuList&#x27;);

        &#x2F;&#x2F; Ecosystem combobox
        var ecoCombobox = document.getElementById(&#x27;ecosystemMenuList&#x27;);

        &#x2F;&#x2F; Message types combobox
        var combobox = document.getElementById(&#x27;messageTypeMenuList&#x27;);

        &#x2F;&#x2F; Check if an ecosystem has been selected
        if (ecoCombobox.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Scan the array of SEPAmail message types
            for (var i = 0; i &lt; this._smethEcosystems[ecoCombobox.selectedIndex].messages.length; i++) {

                &#x2F;&#x2F; Add message type to the combobox
                combobox.appendItem(this._smethEcosystems[ecoCombobox.selectedIndex].messages[i],
                    this._smethEcosystems[ecoCombobox.selectedIndex].messages[i], &#x27;&#x27;);
            }
        }

        &#x2F;&#x2F; Select the first item in the combobox if it contains items
        if (combobox.itemCount &gt; 0) {
            combobox.selectedIndex = 0;
        } else {
            this._showNoComposeMenuUi(SMETHAdvancedPrefpaneLocale.nodefinedMessageTypeMessage);
        }
    },

    &#x2F;**
     * Get the index of a given acknowledgement message type from the array of acknowledgement message types
     *
     * @method _getAcknowledgementMessageTypeIndex
     * @param {String} messageType Acknowledgement message type
     * @return {Integer} Index of the message type in the array of acknowledgement message type
     *&#x2F;
    _getAcknowledgementMessageTypeIndex : function(messageType) {

        &#x2F;&#x2F; Scan the array of acknowledgement message types
        for (var i = 0; i &lt; this._smethAcknowledgementMessageTypes.length; i++) {

            &#x2F;&#x2F; Check if we are at the required message type
            if (this._smethAcknowledgementMessageTypes[i] == messageType) {

                &#x2F;&#x2F; Required message type has been found
                return i;
            }
        }

        &#x2F;&#x2F; Message type was not found in the acknowledgement message type array
        return -1;
    },

    &#x2F;**
     * Build the array of SEPAmail message types for which acknowledgement missive documents are sent
     *
     * @method _getAcknowledgementMessageTypes
     *&#x2F;
    _getAcknowledgementMessageTypes : function() {

        &#x2F;&#x2F; Initialise SEPAmail acknowledgement message types array
        if (this._smethAcknowledgementMessageTypes == null) {
            this._smethAcknowledgementMessageTypes = new Array();
        }

        &#x2F;&#x2F; Acknowledgement message types
        var ackMessageTypes = this._smethPreferences.getCharPref(&#x27;acknowledgement.types&#x27;).split(&#x27;,&#x27;);

        &#x2F;&#x2F; Build the array of acknowledgement message types
        for (var i = 0; i &lt; ackMessageTypes.length; i++) {
            this._smethAcknowledgementMessageTypes.push(ackMessageTypes[i].trim());
        }

        &#x2F;&#x2F; Sort the array of acknowledgement message types
        this._smethAcknowledgementMessageTypes.sort();
    },

    &#x2F;**
     * Get the index of a message composition setting for a specific ecosystem and message type
     *
     * @method _getCompositionSettingsIndex
     * @param {String} ecosystemId ID of ecosystem
     * @param {String} messageType SEPAmail message type
     * @return {Integer} Index of message composition setting
     *&#x2F;
    _getCompositionSettingsIndex : function(ecosystemId, messageType) {

        &#x2F;&#x2F; Scan the list of message composition settings
        for (var i = 0; i &lt; this._smethCompositionSettings.length; i++) {

            &#x2F;&#x2F; Current message composition setting
            var currentCompositionSetting = this._smethCompositionSettings[i];

            &#x2F;&#x2F; Check if we are the required message composition setting
            if (currentCompositionSetting.ecosystemId == ecosystemId &amp;&amp;
                currentCompositionSetting.messageType == messageType) {
                return i;
            }
        }

        return -1;
    },

    &#x2F;**
     * Get the index of an ecosystem from the ecosystem array by the given ecosystem ID
     *
     * @method _getEcosystemIndex
     * @param {String} ecosystemId Ecosystem ID
     * @return {Interger} Index of ecosystem with the given ID
     *&#x2F;
    _getEcosystemIndex : function(ecosystemId) {

        &#x2F;&#x2F; Scan the array of ecosystems
        for (var i = 0; i &lt; this._smethEcosystems.length; i++) {

            &#x2F;&#x2F; Check if we have the required ID
            if (this._smethEcosystems[i].id == ecosystemId) {
                return i;
            }
        }

        return -1;
    },

    &#x2F;**
     * Get the index of a given message type from the array of SEPAmail message types
     *
     * @method _getMessageTypeIndex
     * @param {String} messageType SEPAmail message type
     * @return {Interger} Index of the message type in the array of SEPAmail message types
     *&#x2F;
    _getMessageTypeIndex : function(messageType) {

        &#x2F;&#x2F; Scan the array of SEPAmail message types
        for (var i = 0; i &lt; this._smethMessageTypes.length; i++) {

            &#x2F;&#x2F; Check if we are at the required message type
            if (this._smethMessageTypes[i] == messageType) {

                &#x2F;&#x2F; Required message type has been found
                return i;
            }
        }

        &#x2F;&#x2F; Message type was not found in the SEPAmail message type array
        return -1;
    },

    &#x2F;**
     * Build the array of SEPAmail message types
     *
     * @method _getMessageTypes
     *&#x2F;
    _getMessageTypes : function() {

        &#x2F;&#x2F; Initialise SEPAmail message types array
        if (this._smethMessageTypes == null) {
            this._smethMessageTypes = new Array();
        }

        &#x2F;&#x2F; Message types
        var messageTypes = this._smethPreferences.getCharPref(&#x27;missive.prefSEPAmailMessageTypes&#x27;).split(&#x27;;&#x27;);

        &#x2F;&#x2F; Build the array of message types
        for (var i = 0; i &lt; messageTypes.length; i++) {
            this._smethMessageTypes.push(messageTypes[i].trim());
        }

        &#x2F;&#x2F; Sort the array of message types
        this._smethMessageTypes.sort();
    },

    &#x2F;**
     * Get settings for a given message type
     *
     * @method _getSettingsForMessageType
     * @param {String} messageType Message type for which settings need to be obtained
     * @return {Object} Settings for message type
     *&#x2F;
    _getSettingsForMessageType : function(messageType) {

        &#x2F;&#x2F; Scan the list of settings for message types
        for (var i = 0; i &lt; this._smethControllerConfigSettings.length; i++) {

            &#x2F;&#x2F; Check the message type for the current message type
            if (this._smethControllerConfigSettings[i].type == messageType) {
                return this._smethControllerConfigSettings[i].settings;
            }
        }

        return null;
    },

    &#x2F;**
     * Initialise SMETH preferences class
     *
     * @method _initSmethPreferences
     *&#x2F;
    _initSmethPreferences : function() {

        &#x2F;&#x2F; Check if SMETH preferences has been initialised
        if (!this._smethPreferencesHasBeenInitialised) {

            &#x2F;&#x2F; Initialise SMETH preferences
            this._smethPreferences.QueryInterface(Components.interfaces.nsIPrefBranch2);
            this._smethPreferencesHasBeenInitialised = true;
        }
    },

    &#x2F;**
     * Fill in the list of SEPAmail acknowledgement message types
     *
     * @method _populateAcknowledgementMessageTypes
     *&#x2F;
    _populateAcknowledgementMessageTypes : function() {

        &#x2F;&#x2F; SEPAmail acknowledgement message types listbox
        var listbox = document.getElementById(&#x27;acknowledgementMessageTypes&#x27;);

        &#x2F;&#x2F; Add acknowledgement message types to the listbox
        for (var i = 0; i &lt; this._smethAcknowledgementMessageTypes.length; i++) {
            listbox.appendItem(this._smethAcknowledgementMessageTypes[i], this._smethAcknowledgementMessageTypes[i]);
        }
    },

    &#x2F;**
     * Fill in the list of message composition settings
     *
     * @method _populateCompositionSettings
     *&#x2F;
    _populateCompositionSettings : function() {

        &#x2F;&#x2F; Clear the elements of the message composition type settings list
        this._clearListbox(&#x27;composeMessageSettingsList&#x27;);

        &#x2F;&#x2F; Listbox of message composition settings
        var listbox = document.getElementById(&#x27;composeMessageSettingsList&#x27;);

        &#x2F;&#x2F; Scan the list object
        for (var i = 0; i &lt; this._smethCompositionSettings.length; i++) {

            &#x2F;&#x2F; Current message composition setting
            var currentItem = this._smethCompositionSettings[i];

            &#x2F;&#x2F; Listbox row
            var row = document.createElement(&#x27;listitem&#x27;);

            &#x2F;&#x2F; Get the name of the related ecosystem
            var ecosystemIndex = this._getEcosystemIndex(currentItem.ecosystemId);

            &#x2F;&#x2F; Add the ecosystem to the row
            var ecosystemCell = document.createElement(&#x27;listcell&#x27;);
            ecosystemCell.setAttribute(&#x27;label&#x27;, this._smethEcosystems[ecosystemIndex].name);
            row.appendChild(ecosystemCell);

            &#x2F;&#x2F; Add the message type to the row
            var messageTypeCell = document.createElement(&#x27;listcell&#x27;);
            messageTypeCell.setAttribute(&#x27;label&#x27;, currentItem.messageType);
            row.appendChild(messageTypeCell);

            &#x2F;&#x2F; Add the row to the listbox
            listbox.appendChild(row);
        }
    },

    &#x2F;**
     * Fill in the list of ecosystems handled by SMETH
     *
     * @method _populateEcosystems
     *&#x2F;
    _populateEcosystems : function() {

        &#x2F;&#x2F; Clear any items that might be present in the ecosystem listbox
        this._clearListbox(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Ecosystem listbox
        var listbox = document.getElementById(&#x27;ecosystemsListbox&#x27;);

        &#x2F;&#x2F; Fill in the list of ecosystems
        for (var i = 0; i &lt; this._smethEcosystems.length; i++) {
            listbox.appendItem(this._smethEcosystems[i].name, this._smethEcosystems[i].id);
        }
    },

    &#x2F;**
     * Fill in the list of SEPAmail message types
     *
     * @method _populateMessageTypes
     *&#x2F;
    _populateMessageTypes : function() {

        &#x2F;&#x2F; SEPAmail message types listbox
        var listbox = document.getElementById(&#x27;sepamailMessageTypes&#x27;);

        &#x2F;&#x2F; Add message types to the listbox
        for (var i = 0; i &lt; this._smethMessageTypes.length; i++) {
            listbox.appendItem(this._smethMessageTypes[i], this._smethMessageTypes[i]);
        }
    },

    &#x2F;**
     * Fill in the list of SEPAmail message types for settings configuration
     *
     * @method _populateMessageSettingTypes
     *&#x2F;
    _populateMessageSettingTypes : function() {

        &#x2F;&#x2F; SEPAmail message types listbox
        var listbox = document.getElementById(&#x27;sepamailMessageTypeSettings&#x27;);

        &#x2F;&#x2F; Add message types to the listbox
        for (var i = 0; i &lt; this._smethMessageTypes.length; i++) {
            listbox.appendItem(this._smethMessageTypes[i], this._smethMessageTypes[i]);
        }
    },

    &#x2F;**
     * Remove message composition settings for a specific ecosystem
     *
     * @method _removeCompositionSettingsByEcosystemId
     * @param {String} ecosystemId ID of ecosystem for which message composition settings need to be removed
     *&#x2F;
    _removeCompositionSettingsByEcosystemId : function(ecosystemId) {

        var savedCompositionSettings = [];

        &#x2F;&#x2F; Scan the array of message composition settings
        for (var i = 0; i &lt; this._smethCompositionSettings.length; i++) {

            &#x2F;&#x2F; Check the ecosystem ID of the current composition setting
            if (this._smethCompositionSettings[i].ecosystemId != ecosystemId) {
                savedCompositionSettings.push(this._smethCompositionSettings[i]);
            }
        }

        &#x2F;&#x2F; Re-assign the message composition settings array
        this._smethCompositionSettings = savedCompositionSettings;

        &#x2F;&#x2F; Update the list of message settings
        this._populateCompositionSettings();
    },

    &#x2F;**
     * Remove message composition settings for a specific type of message
     *
     * @method _removeCompositionSettingsByMessageType
     * @param {String} messageType Type of SEPAmail message for which message composition settings need to be removed
     *&#x2F;
    _removeCompositionSettingsByMessageType : function(messageType) {

        var savedCompositionSettings = [];

        &#x2F;&#x2F; Scan the array of message composition settings
        for (var i = 0; i &lt; this._smethCompositionSettings.length; i++) {

            &#x2F;&#x2F; Check the message type of the current composition setting
            if (this._smethCompositionSettings[i].messageType != messageType) {
                savedCompositionSettings.push(this._smethCompositionSettings[i]);
            }
        }

        &#x2F;&#x2F; Re-assign the message composition settings array
        this._smethCompositionSettings = savedCompositionSettings;

        &#x2F;&#x2F; Update the list of message settings
        this._populateCompositionSettings();
    },

    &#x2F;**
     * Show UI elements which indicate that message composition menus cannot be added to SMETH
     *
     * @method _showNoComposeMenuUi
     * @param {String} message Message that needs to be displayed to the user
     *&#x2F;
    _showNoComposeMenuUi : function(message) {

        &#x2F;&#x2F; Get UI elements for message composition
        var compositionUiContainer = document.getElementById(&#x27;compositionSettingsContainer&#x27;);
        var noCompositionUi = document.getElementById(&#x27;noCompositionUiContainer&#x27;);

        &#x2F;&#x2F; Check if a message has been defined
        if (message == null) {

            &#x2F;&#x2F; Show the message composition UI
            compositionUiContainer.hidden = false;

            &#x2F;&#x2F; Hide the no message composition menu UI if it is defined
            if (noCompositionUi != null) {
                noCompositionUi.hidden = true;
            }

        } else {

            &#x2F;&#x2F; Hide the message composition UI
            compositionUiContainer.hidden = true;

            &#x2F;&#x2F; Define the no message composition UI if it is not defined
            if (noCompositionUi == null) {

                &#x2F;&#x2F; Create no message composition UI
                var container = document.createElement(&#x27;vbox&#x27;);
                container.id = &#x27;noCompositionUiContainer&#x27;;
                container.setAttribute(&#x27;align&#x27;, &#x27;center&#x27;);
                container.setAttribute(&#x27;flex&#x27;, &#x27;1&#x27;);
                container.setAttribute(&#x27;pack&#x27;, &#x27;center&#x27;);

                &#x2F;&#x2F; No message composition UI message
                var description = document.createElement(&#x27;description&#x27;);
                description.id = &#x27;noCompositionUiMessage&#x27;;
                description.setAttribute(&#x27;crop&#x27;, &#x27;end&#x27;);
                description.setAttribute(&#x27;style&#x27;, &#x27;text-align:center;&#x27;);
                description.textContent = message;

                &#x2F;&#x2F; Add the message to the container
                container.appendChild(description);

                &#x2F;&#x2F; Add the container to the tab panel
                document.getElementById(&#x27;messageCompositionTabPanel&#x27;).appendChild(container);

            } else {

                &#x2F;&#x2F; Show the no composition UI
                noCompositionUi.hidden = false;

                &#x2F;&#x2F; Update the message displayed in the no message composition UI
                document.getElementById(&#x27;noCompositionUiMessage&#x27;).textContent = message;
            }
        }
    }
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
