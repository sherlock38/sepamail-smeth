<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>content&#x2F;preferences&#x2F;controllers&#x2F;SMETHQXBANPreferencesController.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/SMETHAcknowledgementController.html">SMETHAcknowledgementController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAcknowledgementPreferencesController.html">SMETHAcknowledgementPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAdvancedPreferencesController.html">SMETHAdvancedPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHAttachmentController.html">SMETHAttachmentController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHBankPreferencesController.html">SMETHBankPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHComposeMessageController.html">SMETHComposeMessageController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHControlFactory.html">SMETHControlFactory</a></li>
            
                <li><a href="..&#x2F;classes/SMETHHeaderController.html">SMETHHeaderController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMail.html">SMETHMail</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMailPreferencesController.html">SMETHMailPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHMessageHandler.html">SMETHMessageHandler</a></li>
            
                <li><a href="..&#x2F;classes/SMETHOptionController.html">SMETHOptionController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHQXBANPreferencesController.html">SMETHQXBANPreferencesController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHReadMessageController.html">SMETHReadMessageController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHReportController.html">SMETHReportController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHRequestController.html">SMETHRequestController</a></li>
            
                <li><a href="..&#x2F;classes/SMETHUtils.html">SMETHUtils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/smeth.html">smeth</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: content&#x2F;preferences&#x2F;controllers&#x2F;SMETHQXBANPreferencesController.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;* ***** BEGIN LICENSE BLOCK *****
 * This file is part of smeth (https:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;sepamail-smeth&#x2F;)
 *
 * Version: MPL 2.0&#x2F;GPL 3.0&#x2F;LGPL 3.0
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 2.0 (the &quot;License&quot;); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http:&#x2F;&#x2F;www.mozilla.org&#x2F;MPL&#x2F;2.0&#x2F;
 *
 * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Initials Developers of the Original Code are :
 *  Ammit Heeramun, idSoft
 *  Bishan Kumar Madhoo, idSoft
 *  Manfred Sherlock Olm, deciBI &amp; vizGet
 * Portions created by the Initials Developers are Copyright (C) 2012
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *  Ammit Heeramun
 *  Bishan Kumar Madhoo 
 *  Manfred Sherlock Olm, smeth@decibi.fr
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 3 or later (the &quot;GPL&quot;), or
 * the GNU Lesser General Public License Version 3.0 or later (the &quot;LGPL&quot;),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** *&#x2F;

&#x2F;**
 * @module smeth
 * @file SMETHQXBANPreferencesController.js
 * @mvc controller
 * @version 1212
 * @since 1210
 * @author Bishan Kumar Madhoo
 * @description SMETHQXBANPreferencesController manages the SMETH QXBAN preference pane
 *&#x2F;

&#x2F;**
 * SMETHMessageHandler class contain functions to handle info, error, warning and exceptions messages
 * 
 * @include SMETHMessageHandler.js
 *&#x2F;
Components.utils.import(&quot;resource:&#x2F;&#x2F;smeth&#x2F;smethlib&#x2F;SMETHMessageHandler.js&quot;);

&#x2F;**
 * Strict mode for scripts
 * @see https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;JavaScript&#x2F;Reference&#x2F;Functions_and_function_scope&#x2F;Strict_mode
 *
 *&#x2F;
&quot;use strict&quot;;

&#x2F;**
 * SMETHQXBANPreferencesController manages the SMETH QXBAN preference pane
 * 
 * @class SMETHQXBANPreferencesController
 *&#x2F;
var SMETHQXBANPreferencesController = {

    &#x2F;**
     * Declare the SMETHMessageHandler class
     * 
     * @attribute _smethMessageHandler
     * @private
     *&#x2F;
    _smethMessageHandler : new SMETHMessageHandler(window),

    &#x2F;**
     * SMETH preferences initialisation flag
     * 
     * @attribute _smethPreferencesHasBeenInitialised
     * @private
     * @default false
     *&#x2F;
    _smethPreferencesHasBeenInitialised : false,

    &#x2F;**
     * Declare the smeth preferences class
     * 
     * @attribute _smethPreferences
     * @private
     * @see https:&#x2F;&#x2F;developer.mozilla.org&#x2F;en-US&#x2F;docs&#x2F;Code_snippets&#x2F;Preferences#XPCOM_interfaces_for_preferences_system
     *&#x2F;
    _smethPreferences : Components.classes[&quot;@mozilla.org&#x2F;preferences-service;1&quot;]
                                  .getService(Components.interfaces.nsIPrefService)
                                  .getBranch(&#x27;extensions.smeth.&#x27;),

    &#x2F;**
     * SMETH email addresses and QXBAN list object
     * 
     * @attribute _smethEmailToQxbanObj
     * @private
     * @default null
     *&#x2F;
    _smethEmailToQxbanObj : null,

    &#x2F;**
     * Populate the email and QXBAN textboxes with the selected row values
     * 
     * @method edit
     *&#x2F;
    edit : function() {

        &#x2F;&#x2F; Listbox of email addresses and corresponding QXBAN
        var listboxQxban = document.getElementById(&#x27;listboxQxBan&#x27;);

        &#x2F;&#x2F; Set the values of the email address and QXBAN textboxes as per the selected item
        document.getElementById(&#x27;textboxEmail&#x27;).value = listboxQxban.selectedItem.children[0].getAttribute(&#x27;label&#x27;);
        document.getElementById(&#x27;textboxQxban&#x27;).value = listboxQxban.selectedItem.children[1].getAttribute(&#x27;label&#x27;);
    },

    &#x2F;**
     * Handle the change event when text in the email textbox changes
     * 
     * @method emailInput
     *&#x2F;
    emailInput : function() {

        &#x2F;&#x2F; Check if we have content in the email address and QXBAN textboxes
        if ((document.getElementById(&#x27;textboxEmail&#x27;).value.trim().length &gt; 0) &amp;&amp;
            (document.getElementById(&#x27;textboxQxban&#x27;).value.trim().length &gt; 0)) {
            document.getElementById(&#x27;buttonAddEmailQxbanTuple&#x27;).disabled = false;
        } else {
            document.getElementById(&#x27;buttonAddEmailQxbanTuple&#x27;).disabled = true;
        }
    },

    &#x2F;**
     * Initialise the SMETH QXBAN preference pane
     * 
     * @method onPaneLoad
     *&#x2F;
    onPaneLoad : function() {

        &#x2F;&#x2F; Initialise SMETH preferences
        this._initSmethPreferences();

        try {

            &#x2F;&#x2F; Initialise the email addresses to QXBAN list object
            this._smethEmailToQxbanObj = JSON.parse(this._smethPreferences.getCharPref(&#x27;qxbans&#x27;));

            &#x2F;&#x2F; Populate the listbox of email addresses and corresponding QXBAN
            if (this._smethEmailToQxbanObj != null) {
                this._refreshList();
            }

        } catch (e) {
            this._smethMessageHandler.exception(e);
        }
    },

    &#x2F;**
     * Handle the list of email address and corresponding QXBAN selection event
     * 
     * @method onSelectListItem
     *&#x2F;
    onSelectListItem : function() {

        &#x2F;&#x2F; Set button states
        document.getElementById(&#x27;buttonAddEmailQxbanTuple&#x27;).disabled = true;
        document.getElementById(&#x27;buttonEditEmailQxbanTuple&#x27;).disabled = false;
        document.getElementById(&#x27;buttonRemoveEmailQxbanTuple&#x27;).disabled = false;
    },

    &#x2F;**
     * Handle the change event when text in the QXBAN textbox changes
     * 
     * @method qxbanInput
     *&#x2F;
    qxbanInput : function() {

        &#x2F;&#x2F; Check if we have content in the email address and QXBAN textboxes
        if ((document.getElementById(&#x27;textboxEmail&#x27;).value.trim().length &gt; 0) &amp;&amp;
            (document.getElementById(&#x27;textboxQxban&#x27;).value.trim().length &gt; 0)) {
            document.getElementById(&#x27;buttonAddEmailQxbanTuple&#x27;).disabled = false;
        } else {
            document.getElementById(&#x27;buttonAddEmailQxbanTuple&#x27;).disabled = true;
        }
    },

    &#x2F;**
     * Remove the selected e-mail address and QXBAN pair from the list of correspondants
     * 
     * @method remove
     *&#x2F;
    remove : function() {

        &#x2F;&#x2F; Listbox of email addresses and corresponding QXBAN
        var listboxQxban = document.getElementById(&#x27;listboxQxBan&#x27;);

        &#x2F;&#x2F; Remove the object associated to the selected row from the array of objects
        if (listboxQxban.selectedIndex &gt; -1) {

            &#x2F;&#x2F; Remove the object from the array of email addresses and corresponding QXBAN
            this._smethEmailToQxbanObj.splice(listboxQxban.selectedIndex, 1);

            &#x2F;&#x2F; Reset the values of the email address and QXBAN textboxes
            document.getElementById(&#x27;textboxEmail&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;textboxQxban&#x27;).value = &#x27;&#x27;;

            &#x2F;&#x2F; Disable buttons for editing and deleting email address row and corresponding QXBAN
            document.getElementById(&#x27;buttonEditEmailQxbanTuple&#x27;).disabled = true;
            document.getElementById(&#x27;buttonRemoveEmailQxbanTuple&#x27;).disabled = true;

            &#x2F;&#x2F; Update the preference for email addresses and corresponding QXBAN
            this._updatePreferences();

            &#x2F;&#x2F; Clear the list of displayed email addresses and corresponding QXBAN
            this._clearList();

            &#x2F;&#x2F; Update the list of displayed email addresses and corresponding QXBAN
            this._refreshList();

            &#x2F;&#x2F; Set the selected index of the listbox
            listboxQxban.selectedIndex = -1;

            &#x2F;&#x2F; Set focus to the list of email addresses and corresponding QXBAN
            listboxQxban.focus();
        }
    },

    &#x2F;**
     * Save the specified e-mail address and QXBAN pair to the list of correspondants
     * 
     * @method save
     *&#x2F;
    save : function() {

        &#x2F;&#x2F; Get the email address and QXBAN of the correspondant
        var email = document.getElementById(&#x27;textboxEmail&#x27;).value.trim();
        var qxban = document.getElementById(&#x27;textboxQxban&#x27;).value.trim();

        &#x2F;&#x2F; Check if the email address and corresponding QXBAN are valid
        if (email.length &gt; 0 &amp;&amp; qxban.length &gt; 0) {

            &#x2F;&#x2F; Get the index of the object corresponding to the given email address
            var objIndex = this._getItemIndexFromObject(email);

            &#x2F;&#x2F; Listbox of email addresses and corresponding QXBAN
            var listboxQxBan = document.getElementById(&#x27;listboxQxBan&#x27;);

            &#x2F;&#x2F; Check if we already have an email address in the array
            if (objIndex &gt; -1) {

                &#x2F;&#x2F; Update the QXBAN in the array of email addresses to QXBAN
                this._smethEmailToQxbanObj[objIndex].qxban = qxban;

            } else {

                &#x2F;&#x2F; Set the index of the newly inserted item
                objIndex = this._smethEmailToQxbanObj.length;

                &#x2F;&#x2F; Email address does not exist, so we add a new object
                this._smethEmailToQxbanObj.push({&#x27;email&#x27; : email, &#x27;qxban&#x27; : qxban});
            }

            &#x2F;&#x2F; Reset the values of the email address and QXBAN textboxes
            document.getElementById(&#x27;textboxEmail&#x27;).value = &#x27;&#x27;;
            document.getElementById(&#x27;textboxQxban&#x27;).value = &#x27;&#x27;;

            &#x2F;&#x2F; Update the preference for email addresses and corresponding QXBAN
            this._updatePreferences();

            &#x2F;&#x2F; Clear the list of displayed email addresses and corresponding QXBAN
            this._clearList();

            &#x2F;&#x2F; Update the list of displayed email addresses and corresponding QXBAN
            this._refreshList();

            &#x2F;&#x2F; Select the updated row
            listboxQxBan.selectedIndex = objIndex;

            &#x2F;&#x2F; Make sure that the selected item is visible
            listboxQxBan.scrollToIndex(objIndex);

            &#x2F;&#x2F; Set focus to list of email addresses and corresponding QXBAN
            listboxQxBan.focus();
        }
    },

    &#x2F;**
     * Remove the rows that are being displayed in the list of email addresses and corresponding QXBAN
     * 
     * @method _clearList
     *&#x2F;
    _clearList : function() {

        &#x2F;&#x2F; Listbox of email addresses and corresponding QXBAN
        var listboxQxban = document.getElementById(&#x27;listboxQxBan&#x27;);

        &#x2F;&#x2F; Remove all the rows in the list
        for (var i = listboxQxban.itemCount; i &gt; -1; i--) {
            listboxQxban.removeItemAt(i);
        }
    },

    &#x2F;**
     * Get the index of a specified email address from the array of email address to QXBAN objects
     *
     * @method _getItemIndexFromObject
     * @param {String} email Email address
     * @return {Interger} Index of email address in the array of email addresses to QXBAN objects
     *&#x2F;
    _getItemIndexFromObject : function(email) {

        &#x2F;&#x2F; Scan the array of email addresses to QXBAN objects
        for (var i = 0; i &lt; this._smethEmailToQxbanObj.length; i++) {

            &#x2F;&#x2F; Current object
            var currentObj = this._smethEmailToQxbanObj[i];

            &#x2F;&#x2F; Check the email address associated with the current object
            if (currentObj.email.trim().toLowerCase() == email.toLowerCase()) {
                return i;
            }
        }

        &#x2F;&#x2F; Item could not be found
        return -1;
    },

    &#x2F;**
     * Initialise SMETH preferences class
     * 
     * @method _initSmethPreferences
     *&#x2F;
    _initSmethPreferences : function() {

        &#x2F;&#x2F; Check if SMETH preferences has been initialised
        if (!this._smethPreferencesHasBeenInitialised) {

            &#x2F;&#x2F; Initialise SMETH preferences
            this._smethPreferences.QueryInterface(Components.interfaces.nsIPrefBranch2);
            this._smethPreferencesHasBeenInitialised = true;
        }
    },

    &#x2F;**
     * Update the list of email addresses to QXBAN rows in the listbox
     * 
     * @method _refreshList
     *&#x2F;
    _refreshList : function() {

        &#x2F;&#x2F; Listbox of email addresses and corresponding QXBAN
        var listboxQxban = document.getElementById(&#x27;listboxQxBan&#x27;);

        &#x2F;&#x2F; Scan the list object
        for (var i = 0; i &lt; this._smethEmailToQxbanObj.length; i++) {

            &#x2F;&#x2F; Current email address and corresponding QXBAN item
            var currentItem = this._smethEmailToQxbanObj[i];

            &#x2F;&#x2F; Listbox row
            var row = document.createElement(&#x27;listitem&#x27;);

            &#x2F;&#x2F; Add the email address to the row
            var emailCell = document.createElement(&#x27;listcell&#x27;);
            emailCell.setAttribute(&#x27;label&#x27;, currentItem.email);
            row.appendChild(emailCell);

            &#x2F;&#x2F; Add the corresponding QXBAN to the row
            var qxbanCell = document.createElement(&#x27;listcell&#x27;);
            qxbanCell.setAttribute(&#x27;label&#x27;, currentItem.qxban);
            row.appendChild(qxbanCell);

            &#x2F;&#x2F; Add the row to the listbox
            listboxQxban.appendChild(row);
        }
    },

    &#x2F;**
     * Update the preference for email addresses and corresponding QXBAN
     * 
     * @method _updatePreferences
     *&#x2F;
    _updatePreferences : function() {

        &#x2F;&#x2F; Save the preference setting for email addresses and corresponding QXBAN
        this._smethPreferences.setCharPref(&#x27;qxbans&#x27;, JSON.stringify(this._smethEmailToQxbanObj));
    }
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
